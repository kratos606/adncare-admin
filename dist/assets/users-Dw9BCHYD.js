import{r as o,u as k,U as E,j as e,L as I,a as f,B as g}from"./index-CdkbwK6B.js";import{D as A,G as D,E as z}from"./Edit-Ds7VHfCL.js";import{D as N}from"./Delete-kRsdOOVQ.js";import{B as i,T as $}from"./Box-DAti2-1c.js";import{C as x}from"./CircularProgress-DWt0ae3m.js";import{B as L}from"./Button-DNkXxOpl.js";import{S as P}from"./Snackbar-CiqW6jiD.js";import{A as T}from"./Alert-yMGXwrAF.js";import{I as y}from"./IconButton--_e1gMNA.js";import"./TextField-A2G-ApWF.js";import"./List-DiWJlGpm.js";import"./createSvgIcon-Dch7dBPN.js";import"./MenuItem-CYSELHha.js";import"./listItemTextClasses-O8vYr-t7.js";import"./listItemIconClasses-zDKzmrz6.js";import"./Toolbar-BqnpZL2F.js";import"./Badge-cVd510n2.js";import"./index-BHC3bFsr.js";import"./toPropertyKey-B9UmubNl.js";import"./ListItemText-DjtpQp4G.js";import"./Stack-Rq1LG8dl.js";import"./useThemeProps-BR57ylZ7.js";const ne=()=>{const[j,w]=o.useState([]),[v,c]=o.useState(!0),[a,t]=o.useState({open:!1,message:"",severity:"success"}),n=k(),{user:F,isAuthenticated:d,isLoading:b}=o.useContext(E),m=async()=>{var s;c(!0);try{const r=await f.get(`${g}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});w(r.data.users)}catch(r){console.error("Error fetching users:",r),((s=r.response)==null?void 0:s.status)===401?(t({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),n("/login")):t({open:!0,message:"Failed to fetch users.",severity:"error"})}finally{c(!1)}};if(o.useEffect(()=>{d&&m()},[d]),b)return e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(x,{})});const p=()=>{t({...a,open:!1})},C=s=>{n(`/update/${s}`)},B=async s=>{var r,u,h;if(window.confirm("Are you sure you want to delete this user?"))try{await f.delete(`${g}/users/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t({open:!0,message:"User deleted successfully.",severity:"success"}),m()}catch(l){if(console.error("Error deleting user:",l),((r=l.response)==null?void 0:r.status)===401)t({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),n("/login");else{const U=((h=(u=l.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to delete user.";t({open:!0,message:U,severity:"error"})}}},S=[{field:"id",headerName:"ID",flex:1},{field:"name",headerName:"Name",flex:1},{field:"email",headerName:"Email",flex:1},{field:"actions",headerName:"Actions",width:180,sortable:!1,filterable:!1,renderCell:s=>e.jsxs(e.Fragment,{children:[e.jsx(y,{color:"primary",onClick:()=>C(s.row.id),"aria-label":"update",size:"small",children:e.jsx(z,{})}),e.jsx(y,{color:"secondary",onClick:()=>B(s.row.id),"aria-label":"delete",size:"small",children:e.jsx(N,{})})]})}];return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx($,{variant:"h4",gutterBottom:!0,children:"User Management"}),e.jsx(L,{variant:"contained",color:"primary",component:I,to:"/create",sx:{mb:2},children:"Create User"})]}),v?e.jsx(x,{}):e.jsx(i,{sx:{height:600,width:"100%"},children:e.jsx(A,{rows:j,columns:S,pageSize:10,rowsPerPageOptions:[10,25,50],components:{Toolbar:D},getRowId:s=>s.id})}),e.jsx(P,{open:a.open,autoHideDuration:6e3,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(T,{onClose:p,severity:a.severity,sx:{width:"100%"},children:a.message})})]})};export{ne as default};
