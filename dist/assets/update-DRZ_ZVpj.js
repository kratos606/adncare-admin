import{k as z,r as s,u as q,U as I,j as e,B as h,a as U}from"./index-CjDFkInu.js";import{B as c,T as f}from"./Box-D2ePpQu4.js";import{C as k}from"./CircularProgress-B0eNtYyL.js";import{T as D}from"./TextField-2R_2fVAW.js";import{B as P}from"./Button-BdfboGMk.js";import{S as N}from"./Snackbar-CuilL5fl.js";import{A as W}from"./Alert-JAYxnSnU.js";import"./List-BiWVhqcH.js";import"./createSvgIcon-Wb5NpHkq.js";import"./IconButton-CeC_4U9q.js";const Z=()=>{const{id:x}=z(),[g,v]=s.useState(""),[y,j]=s.useState(""),[b,$]=s.useState(""),[n,E]=s.useState(null),[F,A]=s.useState(!0),[C,S]=s.useState(!1),[u,r]=s.useState({open:!1,message:"",severity:"success"}),i=q(),{isAuthenticated:p,isLoading:m}=s.useContext(I),L=async()=>{var t,a;try{const l=(await U.get(`${h}/galerie-video/${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data;v(l.title),j(l.description),$(l.video_url)}catch(o){console.error("Error fetching video data:",o),((t=o.response)==null?void 0:t.status)===401?(r({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),i("/login")):((a=o.response)==null?void 0:a.status)===404?(r({open:!0,message:"Video not found.",severity:"error"}),i("/galerie/videos")):r({open:!0,message:"Failed to fetch video data.",severity:"error"})}finally{A(!1)}};s.useEffect(()=>{p&&L()},[p]),s.useEffect(()=>{!m&&!p&&i("/login")},[m,p,i]);const V=()=>{r({...u,open:!1})},T=async t=>{var o,l,w,B;if(t.preventDefault(),!g.trim()){r({open:!0,message:"Title is required.",severity:"warning"});return}const a=new FormData;a.append("title",g),a.append("description",y),n&&a.append("video",n),a.append("_method","PUT"),S(!0);try{const d=await U.post(`${h}/galerie-video/${x}`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});r({open:!0,message:"Video updated successfully!",severity:"success"}),setTimeout(()=>{i("/galerie/videos")},1500)}catch(d){if(console.error("Error updating video:",d),((o=d.response)==null?void 0:o.status)===401)r({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),i("/login");else if(((l=d.response)==null?void 0:l.status)===404)r({open:!0,message:"Video not found.",severity:"error"}),i("/galerie/videos");else{const R=((B=(w=d.response)==null?void 0:w.data)==null?void 0:B.message)||"Failed to update video.";r({open:!0,message:R,severity:"error"})}}finally{S(!1)}};return F||m?e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(k,{})}):e.jsxs(c,{sx:{p:3},children:[e.jsx(f,{variant:"h4",gutterBottom:!0,children:"Update Video"}),e.jsxs(c,{component:"form",onSubmit:T,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:600},children:[e.jsx(D,{label:"Title",variant:"outlined",value:g,onChange:t=>v(t.target.value),required:!0}),e.jsx(D,{label:"Description",variant:"outlined",value:y,onChange:t=>j(t.target.value),required:!0}),b&&!n&&e.jsxs(c,{children:[e.jsx(f,{variant:"body2",children:"Current Video:"}),e.jsx("img",{src:`${h}/storage/${b}`,style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsxs(P,{variant:"contained",component:"label",children:[n?"Change Video":"Replace Video",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&E(t.target.files[0])}})]}),n&&e.jsxs(c,{children:[e.jsx(f,{variant:"body2",children:"New Video Preview:"}),e.jsx("img",{src:URL.createObjectURL(n),style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsx(P,{type:"submit",variant:"contained",color:"primary",onClick:T,disabled:C,children:C?e.jsx(k,{size:24}):"Update"})]}),e.jsx(N,{open:u.open,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(W,{onClose:V,severity:u.severity,sx:{width:"100%"},children:u.message})})]})};export{Z as default};
