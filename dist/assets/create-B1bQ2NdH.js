import{r,u as w,U as B,j as e,a as U,B as k}from"./index-CjDFkInu.js";import{B as n,T as y}from"./Box-D2ePpQu4.js";import{C as v}from"./CircularProgress-B0eNtYyL.js";import{T as D}from"./TextField-2R_2fVAW.js";import{B as j}from"./Button-BdfboGMk.js";import{S as F}from"./Snackbar-CuilL5fl.js";import{A as L}from"./Alert-JAYxnSnU.js";import"./List-BiWVhqcH.js";import"./createSvgIcon-Wb5NpHkq.js";import"./IconButton-CeC_4U9q.js";const G=()=>{const[l,b]=r.useState(""),[s,C]=r.useState(null),[c,g]=r.useState(!1),[i,a]=r.useState({open:!1,message:"",severity:"success"}),m=w(),{isAuthenticated:S,isLoading:p}=r.useContext(B);!p&&!S&&m("/login");const d=()=>{a({...i,open:!1})},T=async t=>{var x,f,h;if(t.preventDefault(),!l.trim()){a({open:!0,message:"Title is required.",severity:"warning"});return}if(!s){a({open:!0,message:"Image file is required.",severity:"warning"});return}const u=new FormData;u.append("title",l),u.append("image",s),g(!0);try{const o=await U.post(`${k}/galerie-image`,u,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});a({open:!0,message:"Image uploaded successfully!",severity:"success"}),setTimeout(()=>{m("/galerie/images")},1500)}catch(o){if(console.error("Error uploading image:",o),((x=o.response)==null?void 0:x.status)===401)a({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),m("/login");else{const I=((h=(f=o.response)==null?void 0:f.data)==null?void 0:h.message)||"Failed to upload image.";a({open:!0,message:I,severity:"error"})}}finally{g(!1)}};return p?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(v,{})}):e.jsxs(n,{sx:{p:3},children:[e.jsx(y,{variant:"h4",gutterBottom:!0,children:"Upload New Image"}),e.jsxs(n,{component:"form",onSubmit:T,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:500},children:[e.jsx(D,{label:"Title",variant:"outlined",value:l,onChange:t=>b(t.target.value),required:!0}),e.jsxs(j,{variant:"contained",component:"label",children:["Upload Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&C(t.target.files[0])},required:!0})]}),s&&e.jsxs(n,{children:[e.jsx(y,{variant:"body2",children:"Image Preview:"}),e.jsx("img",{src:URL.createObjectURL(s),alt:"Preview",style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsx(j,{type:"submit",variant:"contained",color:"primary",disabled:c,children:c?e.jsx(v,{size:24}):"Upload"})]}),e.jsx(F,{open:i.open,autoHideDuration:6e3,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(L,{onClose:d,severity:i.severity,sx:{width:"100%"},children:i.message})})]})};export{G as default};
