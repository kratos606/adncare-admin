import{r as s,u as V,U as q,j as e,a as k,B as F}from"./index-CjDFkInu.js";import{B as l,T as y}from"./Box-D2ePpQu4.js";import{C as j}from"./CircularProgress-B0eNtYyL.js";import{T as b}from"./TextField-2R_2fVAW.js";import{B as C}from"./Button-BdfboGMk.js";import{S as L}from"./Snackbar-CuilL5fl.js";import{A}from"./Alert-JAYxnSnU.js";import"./List-BiWVhqcH.js";import"./createSvgIcon-Wb5NpHkq.js";import"./IconButton-CeC_4U9q.js";const M=()=>{const[d,S]=s.useState(""),[u,T]=s.useState(""),[i,w]=s.useState(null),[c,m]=s.useState(!1),[a,r]=s.useState({open:!1,message:"",severity:"success"}),p=V(),{isAuthenticated:B,isLoading:g}=s.useContext(q);!g&&!B&&p("/login");const x=()=>{r({...a,open:!1})},D=async t=>{var f,h,v;if(t.preventDefault(),!d.trim()){r({open:!0,message:"Title is required.",severity:"warning"});return}if(!u.trim()){r({open:!0,message:"Description is required.",severity:"warning"});return}if(!i){r({open:!0,message:"Video file is required.",severity:"warning"});return}const o=new FormData;o.append("title",d),o.append("description",u),o.append("video",i),m(!0);try{const n=await k.post(`${F}/videos`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});r({open:!0,message:"Video uploaded successfully!",severity:"success"}),setTimeout(()=>{p("/videos")},1500)}catch(n){if(console.error("Error uploading video:",n),((f=n.response)==null?void 0:f.status)===401)r({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),p("/login");else{const U=((v=(h=n.response)==null?void 0:h.data)==null?void 0:v.message)||"Failed to upload video.";r({open:!0,message:U,severity:"error"})}}finally{m(!1)}};return g?e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(j,{})}):e.jsxs(l,{sx:{p:3},children:[e.jsx(y,{variant:"h4",gutterBottom:!0,children:"Upload New Video"}),e.jsxs(l,{component:"form",onSubmit:D,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:600},children:[e.jsx(b,{label:"Title",variant:"outlined",value:d,onChange:t=>S(t.target.value),required:!0}),e.jsx(b,{label:"Description",variant:"outlined",value:u,onChange:t=>T(t.target.value),multiline:!0,rows:4,required:!0}),e.jsxs(C,{variant:"contained",component:"label",children:["Upload Video",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&w(t.target.files[0])},required:!0})]}),i&&e.jsxs(l,{children:[e.jsx(y,{variant:"body2",children:"Video Preview:"}),e.jsx("img",{src:URL.createObjectURL(i),style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsx(C,{type:"submit",variant:"contained",color:"primary",disabled:c,children:c?e.jsx(j,{size:24}):"Upload"})]}),e.jsx(L,{open:a.open,autoHideDuration:6e3,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(A,{onClose:x,severity:a.severity,sx:{width:"100%"},children:a.message})})]})};export{M as default};
