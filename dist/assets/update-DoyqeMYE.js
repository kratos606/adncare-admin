import{k as q,r,u as z,U as I,j as e,B as f,a as B}from"./index-CjDFkInu.js";import{B as u,T as x}from"./Box-D2ePpQu4.js";import{C as D}from"./CircularProgress-B0eNtYyL.js";import{T as U}from"./TextField-2R_2fVAW.js";import{B as P}from"./Button-BdfboGMk.js";import{S as N}from"./Snackbar-CuilL5fl.js";import{A as W}from"./Alert-JAYxnSnU.js";import"./List-BiWVhqcH.js";import"./createSvgIcon-Wb5NpHkq.js";import"./IconButton-CeC_4U9q.js";const Z=()=>{const{id:v}=q(),[m,y]=r.useState(""),[g,j]=r.useState(""),[b,$]=r.useState(""),[n,k]=r.useState(null),[E,F]=r.useState(!0),[S,C]=r.useState(!1),[c,s]=r.useState({open:!1,message:"",severity:"success"}),a=z(),{isAuthenticated:p,isLoading:h}=r.useContext(I),A=async()=>{var t,i;try{const l=(await B.get(`${f}/videos/${v}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data;y(l.title),j(l.description),$(l.video_url)}catch(o){console.error("Error fetching video data:",o),((t=o.response)==null?void 0:t.status)===401?(s({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),a("/login")):((i=o.response)==null?void 0:i.status)===404?(s({open:!0,message:"Video not found.",severity:"error"}),a("/videos")):s({open:!0,message:"Failed to fetch video data.",severity:"error"})}finally{F(!1)}};r.useEffect(()=>{p&&A()},[p]),r.useEffect(()=>{!h&&!p&&a("/login")},[h,p,a]);const V=()=>{s({...c,open:!1})},L=async t=>{var o,l,T,w;if(t.preventDefault(),!m.trim()){s({open:!0,message:"Title is required.",severity:"warning"});return}if(!g.trim()){s({open:!0,message:"Description is required.",severity:"warning"});return}const i=new FormData;i.append("title",m),i.append("description",g),n&&i.append("video",n),i.append("_method","PUT"),C(!0);try{const d=await B.post(`${f}/videos/${v}`,i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});s({open:!0,message:"Video updated successfully!",severity:"success"}),setTimeout(()=>{a("/videos")},1500)}catch(d){if(console.error("Error updating video:",d),((o=d.response)==null?void 0:o.status)===401)s({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),a("/login");else if(((l=d.response)==null?void 0:l.status)===404)s({open:!0,message:"Video not found.",severity:"error"}),a("/videos");else{const R=((w=(T=d.response)==null?void 0:T.data)==null?void 0:w.message)||"Failed to update video.";s({open:!0,message:R,severity:"error"})}}finally{C(!1)}};return E||h?e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(D,{})}):e.jsxs(u,{sx:{p:3},children:[e.jsx(x,{variant:"h4",gutterBottom:!0,children:"Update Video"}),e.jsxs(u,{component:"form",onSubmit:L,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:600},children:[e.jsx(U,{label:"Title",variant:"outlined",value:m,onChange:t=>y(t.target.value),required:!0}),e.jsx(U,{label:"Description",variant:"outlined",value:g,onChange:t=>j(t.target.value),multiline:!0,rows:4,required:!0}),b&&!n&&e.jsxs(u,{children:[e.jsx(x,{variant:"body2",children:"Current Video:"}),e.jsx("img",{src:`${f}/storage/${b}`,style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsxs(P,{variant:"contained",component:"label",children:[n?"Change Video":"Replace Video",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&k(t.target.files[0])}})]}),n&&e.jsxs(u,{children:[e.jsx(x,{variant:"body2",children:"New Video Preview:"}),e.jsx("img",{src:URL.createObjectURL(n),style:{maxWidth:"100%",height:"auto",marginTop:"10px"}})]}),e.jsx(P,{type:"submit",variant:"contained",color:"primary",disabled:S,children:S?e.jsx(D,{size:24}):"Update"})]}),e.jsx(N,{open:c.open,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(W,{onClose:V,severity:c.severity,sx:{width:"100%"},children:c.message})})]})};export{Z as default};
