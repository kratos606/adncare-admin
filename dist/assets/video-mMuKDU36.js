import{r as o,u as k,U as A,j as e,N as D,L as N,a as f,B as d}from"./index-CjDFkInu.js";import{D as E,G as $,E as z}from"./Edit-DmLPX9Db.js";import{D as L}from"./Delete-CvnuvFEg.js";import{B as i,T as P}from"./Box-D2ePpQu4.js";import{C as x}from"./CircularProgress-B0eNtYyL.js";import{B as T}from"./Button-BdfboGMk.js";import{S as U}from"./Snackbar-CuilL5fl.js";import{A as F}from"./Alert-JAYxnSnU.js";import{A as G}from"./Avatar-BZ9sbESm.js";import{I as y}from"./IconButton-CeC_4U9q.js";import"./TextField-2R_2fVAW.js";import"./List-BiWVhqcH.js";import"./createSvgIcon-Wb5NpHkq.js";import"./MenuItem-CN9ZeXoF.js";import"./listItemTextClasses-nIyWsBp7.js";import"./listItemIconClasses-HtZTDNXz.js";import"./Toolbar-BYyhnq4y.js";import"./Badge-DORDaMa7.js";import"./index-CXBuU4mF.js";import"./toPropertyKey-B9UmubNl.js";import"./ListItemText-BcybfKQ7.js";import"./Stack-CqQe12en.js";import"./useThemeProps-CDXnS6-V.js";const de=()=>{const[v,j]=o.useState([]),[w,m]=o.useState(!0),[a,t]=o.useState({open:!1,message:"",severity:"success"}),n=k(),{user:R,isAuthenticated:l,isLoading:b}=o.useContext(A),p=async()=>{var r;m(!0);try{const s=await f.get(`${d}/galerie-video`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});j(s.data)}catch(s){console.error("Error fetching images:",s),((r=s.response)==null?void 0:r.status)===401?(t({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),n("/login")):t({open:!0,message:"Failed to fetch images.",severity:"error"})}finally{m(!1)}};if(o.useEffect(()=>{l&&p()},[l]),b)return e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(x,{})});if(!l)return e.jsx(D,{to:"/login",replace:!0});const g=()=>{t({...a,open:!1})},C=r=>{n(`/galerie/videos/update/${r}`)},I=async r=>{var s,u,h;if(window.confirm("Are you sure you want to delete this image?"))try{await f.delete(`${d}/galerie-video/${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t({open:!0,message:"Image deleted successfully.",severity:"success"}),p()}catch(c){if(console.error("Error deleting image:",c),((s=c.response)==null?void 0:s.status)===401)t({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),n("/login");else{const S=((h=(u=c.response)==null?void 0:u.data)==null?void 0:h.message)||"Failed to delete image.";t({open:!0,message:S,severity:"error"})}}},B=[{field:"id",headerName:"ID",flex:.5},{field:"title",headerName:"Title",flex:1},{field:"description",headerName:"Description",flex:1},{field:"video_url",headerName:"Video",flex:1,renderCell:r=>e.jsx(G,{src:`${d}/storage/`+r.value,variant:"square",sx:{width:100,height:60,objectFit:"cover"}})},{field:"actions",headerName:"Actions",width:180,sortable:!1,filterable:!1,renderCell:r=>e.jsxs(e.Fragment,{children:[e.jsx(y,{color:"primary",onClick:()=>C(r.row.id),"aria-label":"update",size:"small",children:e.jsx(z,{})}),e.jsx(y,{color:"secondary",onClick:()=>I(r.row.id),"aria-label":"delete",size:"small",children:e.jsx(L,{})})]})}];return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(P,{variant:"h4",gutterBottom:!0,children:"Video Management"}),e.jsx(T,{variant:"contained",color:"primary",component:N,to:"/galerie/videos/create",sx:{mb:2},children:"Upload Image"})]}),w?e.jsx(x,{}):e.jsx(i,{sx:{height:600,width:"100%"},children:e.jsx(E,{rows:v,columns:B,pageSize:10,rowsPerPageOptions:[10,25,50],components:{Toolbar:$},getRowId:r=>r.id})}),e.jsx(U,{open:a.open,autoHideDuration:6e3,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(F,{onClose:g,severity:a.severity,sx:{width:"100%"},children:a.message})})]})};export{de as default};
