import{k as L,r as a,u as R,U as q,j as e,B as f,a as C}from"./index-CdkbwK6B.js";import{B as n,T as h}from"./Box-DAti2-1c.js";import{C as w}from"./CircularProgress-DWt0ae3m.js";import{T as z}from"./TextField-A2G-ApWF.js";import{A as T}from"./Avatar-puGDwdEu.js";import{B}from"./Button-DNkXxOpl.js";import{S as N}from"./Snackbar-CiqW6jiD.js";import{A as O}from"./Alert-yMGXwrAF.js";import"./List-DiWJlGpm.js";import"./createSvgIcon-Dch7dBPN.js";import"./IconButton--_e1gMNA.js";const Z=()=>{const{id:x}=L(),[p,y]=a.useState(""),[F,U]=a.useState(""),[l,P]=a.useState(null),[$,k]=a.useState(!0),[v,j]=a.useState(!1),[m,s]=a.useState({open:!1,message:"",severity:"success"}),r=R(),{isAuthenticated:u,isLoading:d}=a.useContext(q),A=async()=>{var t,i;try{const c=(await C.get(`${f}/galerie-image/${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data;y(c.title),U(c.image_path)}catch(o){console.error("Error fetching image data:",o),((t=o.response)==null?void 0:t.status)===401?(s({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),r("/login")):((i=o.response)==null?void 0:i.status)===404?(s({open:!0,message:"Image not found.",severity:"error"}),r("galerie/images")):s({open:!0,message:"Failed to fetch image data.",severity:"error"})}finally{k(!1)}};a.useEffect(()=>{u&&A()},[u]),a.useEffect(()=>{!d&&!u&&r("/login")},[d,u,r]);const b=()=>{s({...m,open:!1})},D=async t=>{var o,c,I,S;if(t.preventDefault(),!p.trim()){s({open:!0,message:"Title is required.",severity:"warning"});return}const i=new FormData;i.append("title",p),l&&i.append("image",l),i.append("_method","PUT"),j(!0);try{const g=await C.post(`${f}/galerie-image/${x}`,i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});s({open:!0,message:"Image updated successfully!",severity:"success"}),setTimeout(()=>{r("/galerie/images")},1500)}catch(g){if(console.error("Error updating image:",g),((o=g.response)==null?void 0:o.status)===401)s({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),r("/login");else if(((c=g.response)==null?void 0:c.status)===404)s({open:!0,message:"Image not found.",severity:"error"}),r("/galerie/images");else{const E=((S=(I=g.response)==null?void 0:I.data)==null?void 0:S.message)||"Failed to update image.";s({open:!0,message:E,severity:"error"})}}finally{j(!1)}};return $||d?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(w,{})}):e.jsxs(n,{sx:{p:3},children:[e.jsx(h,{variant:"h4",gutterBottom:!0,children:"Update Image"}),e.jsxs(n,{component:"form",onSubmit:D,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:500},children:[e.jsx(z,{label:"Title",variant:"outlined",value:p,onChange:t=>y(t.target.value),required:!0}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(T,{src:`${f}/storage/${F}`,variant:"square",sx:{width:100,height:60,objectFit:"cover"}}),e.jsxs(B,{variant:"contained",component:"label",children:["Replace Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&P(t.target.files[0])}})]})]}),l&&e.jsxs(n,{children:[e.jsxs(h,{variant:"body2",children:["Selected File: ",l.name]}),e.jsxs(n,{sx:{mt:1,display:"flex",alignItems:"center",gap:2},children:[e.jsx(h,{variant:"body2",children:"Image Preview:"}),e.jsx(T,{src:URL.createObjectURL(l),variant:"square",sx:{width:100,height:60,objectFit:"cover"}})]})]}),e.jsx(B,{type:"submit",variant:"contained",color:"primary",disabled:v,children:v?e.jsx(w,{size:24}):"Update"})]}),e.jsx(N,{open:m.open,autoHideDuration:6e3,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(O,{onClose:b,severity:m.severity,sx:{width:"100%"},children:m.message})})]})};export{Z as default};
