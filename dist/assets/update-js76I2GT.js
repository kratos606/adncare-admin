import{k as z,r as s,u as M,U as N,j as e,B as h,a as F}from"./index-CdkbwK6B.js";import{B as l,T as f}from"./Box-DAti2-1c.js";import{C as w}from"./CircularProgress-DWt0ae3m.js";import{T as O,F as W,I as Y,S as _}from"./TextField-A2G-ApWF.js";import{M as B}from"./MenuItem-CYSELHha.js";import{A as U}from"./Avatar-puGDwdEu.js";import{B as P}from"./Button-DNkXxOpl.js";import{S as H}from"./Snackbar-CiqW6jiD.js";import{A as G}from"./Alert-yMGXwrAF.js";import"./List-DiWJlGpm.js";import"./createSvgIcon-Dch7dBPN.js";import"./listItemTextClasses-O8vYr-t7.js";import"./listItemIconClasses-zDKzmrz6.js";import"./IconButton--_e1gMNA.js";const le=()=>{const{id:x}=z(),[g,v]=s.useState(""),[$,k]=s.useState(""),[c,A]=s.useState(null),[y,j]=s.useState(1),[D,E]=s.useState(!0),[S,b]=s.useState(!1),[d,a]=s.useState({open:!1,message:"",severity:"success"}),i=M(),{isAuthenticated:u,isLoading:p}=s.useContext(N),L=async()=>{var t,r;try{const n=(await F.get(`${h}/images/${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data;v(n.title),k(n.image_path),j(n.slider)}catch(o){console.error("Error fetching image data:",o),((t=o.response)==null?void 0:t.status)===401?(a({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),i("/login")):((r=o.response)==null?void 0:r.status)===404?(a({open:!0,message:"Image not found.",severity:"error"}),i("/images")):a({open:!0,message:"Failed to fetch image data.",severity:"error"})}finally{E(!1)}};s.useEffect(()=>{u&&L()},[u]),s.useEffect(()=>{!p&&!u&&i("/login")},[p,u,i]);const I=()=>{a({...d,open:!1})},q=async t=>{var o,n,C,T;if(t.preventDefault(),!g.trim()){a({open:!0,message:"Title is required.",severity:"warning"});return}const r=new FormData;r.append("title",g),r.append("slider",y),c&&r.append("image",c),r.append("_method","PUT"),b(!0);try{const m=await F.post(`${h}/images/${x}`,r,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("token")}`}});a({open:!0,message:"Image updated successfully!",severity:"success"}),setTimeout(()=>{i("/images")},1500)}catch(m){if(console.error("Error updating image:",m),((o=m.response)==null?void 0:o.status)===401)a({open:!0,message:"Your session has expired. Please login again.",severity:"error"}),i("/login");else if(((n=m.response)==null?void 0:n.status)===404)a({open:!0,message:"Image not found.",severity:"error"}),i("/images");else{const R=((T=(C=m.response)==null?void 0:C.data)==null?void 0:T.message)||"Failed to update image.";a({open:!0,message:R,severity:"error"})}}finally{b(!1)}};return D||p?e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsx(w,{})}):e.jsxs(l,{sx:{p:3},children:[e.jsx(f,{variant:"h4",gutterBottom:!0,children:"Update Image"}),e.jsxs(l,{component:"form",onSubmit:q,sx:{mt:2,display:"flex",flexDirection:"column",gap:2,maxWidth:500},children:[e.jsx(O,{label:"Title",variant:"outlined",value:g,onChange:t=>v(t.target.value),required:!0}),e.jsxs(W,{fullWidth:!0,required:!0,children:[e.jsx(Y,{id:"slider-label",children:"Slider Type"}),e.jsxs(_,{labelId:"slider-label",value:y,label:"Slider Type",onChange:t=>j(t.target.value),children:[e.jsx(B,{value:1,children:"Slider 1"}),e.jsx(B,{value:2,children:"Slider 2"})]})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(U,{src:`${h}/storage/${$}`,variant:"square",sx:{width:100,height:60,objectFit:"cover"}}),e.jsxs(P,{variant:"contained",component:"label",children:["Replace Image",e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&A(t.target.files[0])}})]})]}),c&&e.jsxs(l,{children:[e.jsxs(f,{variant:"body2",children:["Selected File: ",c.name]}),e.jsxs(l,{sx:{mt:1,display:"flex",alignItems:"center",gap:2},children:[e.jsx(f,{variant:"body2",children:"Image Preview:"}),e.jsx(U,{src:URL.createObjectURL(c),variant:"square",sx:{width:100,height:60,objectFit:"cover"}})]})]}),e.jsx(P,{type:"submit",variant:"contained",color:"primary",disabled:S,children:S?e.jsx(w,{size:24}):"Update"})]}),e.jsx(H,{open:d.open,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(G,{onClose:I,severity:d.severity,sx:{width:"100%"},children:d.message})})]})};export{le as default};
